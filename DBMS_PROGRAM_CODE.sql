-- Create the BLOOD_BANK table
CREATE TABLE BLOOD_BANK (
    BLOOD_BANK_ID VARCHAR(20) PRIMARY KEY,
    BNAME VARCHAR(20),
    CITY VARCHAR(20)
);
DROP TABLE BLOOD_BANK;
-- Insert tuples into BLOOD_BANK
INSERT INTO BLOOD_BANK (BLOOD_BANK_ID, BNAME, CITY) VALUES
('BB001', 'Blood Bank 1', 'City 1'),
('BB002', 'Blood Bank 2', 'City 2');
select *from BLOOD_BANK;
-- Create the DONOR table
CREATE TABLE DONOR (
    DONOR_ID VARCHAR(20) PRIMARY KEY,
    DNAME VARCHAR(20),
    GENDER VARCHAR(1),
    BLOOD_GROUP VARCHAR(20),
    AGE INT,
    DOB DATE,
    BLOOD_BANK_ID VARCHAR(20),
    FOREIGN KEY(BLOOD_BANK_ID) REFERENCES BLOOD_BANK(BLOOD_BANK_ID)
);
DROP TABLE DONOR;
SELECT *FROM DONOR;
INSERT INTO DONOR VALUES('D001','DONOR1','M','O+',30,'1994-01-14','BB001');
INSERT INTO DONOR VALUES('D002','DONOR2','F','A-',25,'1999-05-20','BB002');


INSERT INTO DONOR VALUES ('D001', 'Donor 1', 'M', 'O+', 30, '1994-01-15', 'BB001');
INSERT INTO DONOR VALUES ('D002', 'Donor 2', 'F', 'A-', 25, '1999-05-20', 'BB002');
INSERT INTO DONOR VALUES ('D003', 'Donor 3', 'M', 'AB+', 35, '1990-07-10', 'BB001');
INSERT INTO DONOR VALUES ('D004', 'Donor 4', 'F', 'B+', 28, '1996-03-25', 'BB002');
INSERT INTO DONOR VALUES ('D005', 'Donor 5', 'M', 'O-', 40, '1982-09-05', 'BB001');
INSERT INTO DONOR VALUES ('D006', 'Donor 6', 'F', 'A+', 22, '2000-11-30', 'BB002');
INSERT INTO DONOR VALUES ('D007', 'Donor 7', 'M', 'B-', 32, '1989-05-15', 'BB001');
INSERT INTO DONOR VALUES ('D008', 'Donor 8', 'F', 'AB-', 26, '1995-02-20', 'BB002');
INSERT INTO DONOR VALUES ('D009', 'Donor 9', 'M', 'O+', 45, '1979-04-10', 'BB001');
INSERT INTO DONOR VALUES ('D010', 'Donor 10', 'F', 'A-', 29, '1993-08-25', 'BB002');



DELETE FROM DONOR WHERE DONOR_ID='D002';
-- Insert tuples into DONOR
INSERT INTO DONOR (DONOR_ID, DNAME, GENDER, BLOOD_GROUP, AGE, DOB, BLOOD_BANK_ID) VALUES
('D001', 'Donor 1', 'M', 'O+', 30, '1994-01-15', 'BB001'),
('D002', 'Donor 2', 'F', 'A-', 25, '1999-05-20', 'BB002'),
('D003', 'Donor 3', 'M', 'AB+', 35, '1990-07-10', 'BB001'),
('D004', 'Donor 4', 'F', 'B+', 28, '1996-03-25', 'BB002'),
('D005', 'Donor 5', 'M', 'O-', 40, '1982-09-05', 'BB001'),
('D006', 'Donor 6', 'F', 'A+', 22, '2000-11-30', 'BB002'),
('D007', 'Donor 7', 'M', 'B-', 32, '1989-05-15', 'BB001'),
('D008', 'Donor 8', 'F', 'AB-', 26, '1995-02-20', 'BB002'),
('D009', 'Donor 9', 'M', 'O+', 45, '1979-04-10', 'BB001'),
('D010', 'Donor 10', 'F', 'A-', 29, '1993-08-25', 'BB002');

-- Create the BLOOD table
CREATE TABLE BLOOD (
    BLOOD_GROUP VARCHAR(20),
    QUANTITY INT,
    DONOR_ID VARCHAR(20),
    PRIMARY KEY (DONOR_ID, BLOOD_GROUP),
    FOREIGN KEY (DONOR_ID) REFERENCES DONOR(DONOR_ID)
);
select *from BLOOD;
-- Insert tuples into BLOOD
INSERT INTO BLOOD (BLOOD_GROUP, QUANTITY, DONOR_ID) VALUES
('O+', 10, 'D001'),
('A-', 8, 'D002'),
('AB+', 12, 'D003'),
('B+', 6, 'D004'),
('O-', 15, 'D005'),
('A+', 9, 'D006'),
('B-', 5, 'D007'),
('AB-', 7, 'D008'),
('O+', 11, 'D009'),
('A-', 10, 'D010');

-- Create the STAFF table
CREATE TABLE STAFF (
    STAFF_ID INT PRIMARY KEY,
    SNAME VARCHAR(20),
    SALARY INT,
    BLOOD_BANK_ID VARCHAR(20),
    FOREIGN KEY (BLOOD_BANK_ID) REFERENCES BLOOD_BANK(BLOOD_BANK_ID)
);
SELECT *FROM STAFF;
-- Insert tuples into STAFF
INSERT INTO STAFF (STAFF_ID, SNAME, SALARY, BLOOD_BANK_ID) VALUES
(1001, 'Staff 1', 50000, 'BB001'),
(1002, 'Staff 2', 55000, 'BB002'),
(1003, 'Staff 3', 60000, 'BB001'),
(1004, 'Staff 4', 65000, 'BB002'),
(1005, 'Staff 5', 70000, 'BB001'),
(1006, 'Staff 6', 75000, 'BB002'),
(1007, 'Staff 7', 80000, 'BB001'),
(1008, 'Staff 8', 85000, 'BB002'),
(1009, 'Staff 9', 90000, 'BB001'),
(1010, 'Staff 10', 95000, 'BB002');

-- Create the STAFF_PHONE table
CREATE TABLE STAFF_PHONE (
    PHONE_NO INT,
    STAFF_ID INT,
    PRIMARY KEY (PHONE_NO, STAFF_ID),
    FOREIGN KEY (STAFF_ID) REFERENCES STAFF(STAFF_ID)
);
SELECT *FROM STAFF_PHONE;
-- Insert tuples into STAFF_PHONE
INSERT INTO STAFF_PHONE (PHONE_NO, STAFF_ID) VALUES
(123456789, 1001),
(234567890, 1002),
(345678901, 1003),
(456789012, 1004),
(567890123, 1005),
(678901234, 1006),
(789012345, 1007),
(890123456, 1008),
(901234567, 1009),
(123456789, 1010);

-- Create the HOSPITAL table
CREATE TABLE HOSPITAL (
    HOSP_ID VARCHAR(20) PRIMARY KEY,
    HOSP_NAME VARCHAR(20),
    STREET VARCHAR(20),
    CITY VARCHAR(20),
    PINCODE INT
);
SELECT *FROM HOSPITAL;
-- Insert tuples into HOSPITAL
INSERT INTO HOSPITAL (HOSP_ID, HOSP_NAME, STREET, CITY, PINCODE) VALUES
('H001', 'Hospital 1', 'Street 1', 'City 1', 12345),
('H002', 'Hospital 2', 'Street 2', 'City 2', 23456);

-- Create the RECIPIENT table
CREATE TABLE RECIPIENT (
    R_ID VARCHAR(20) PRIMARY KEY,
    RNAME VARCHAR(20),
    DOB DATE,
    GENDER VARCHAR(1),
    BLOOD_GROUP VARCHAR(20),
    HOSP_ID VARCHAR(20),
    BLOOD_BANK_ID VARCHAR(20),
    FOREIGN KEY (BLOOD_BANK_ID) REFERENCES BLOOD_BANK(BLOOD_BANK_ID),
    FOREIGN KEY (HOSP_ID) REFERENCES HOSPITAL(HOSP_ID)
);
SELECT *FROM RECIPIENT;
-- Insert tuples into RECIPIENT
INSERT INTO RECIPIENT (R_ID, RNAME, DOB, GENDER, BLOOD_GROUP, HOSP_ID, BLOOD_BANK_ID) VALUES
('R001', 'Recipient 1', '1990-02-10', 'M', 'AB+', 'H001', 'BB001'),
('R002', 'Recipient 2', '1985-07-20', 'F', 'O-', 'H002', 'BB002'),
('R003', 'Recipient 3', '1978-12-15', 'M', 'B+', 'H001', 'BB001'),
('R004', 'Recipient 4', '1995-05-25', 'F', 'A-', 'H002', 'BB002'),
('R005', 'Recipient 5', '1980-09-30', 'M', 'AB-', 'H001', 'BB001'),
('R006', 'Recipient 6', '1998-11-05', 'F', 'O+', 'H002', 'BB002'),
('R007', 'Recipient 7', '1973-04-15', 'M', 'B-', 'H001', 'BB001'),
('R008', 'Recipient 8', '1989-02-20', 'F', 'A+', 'H002', 'BB002'),
('R009', 'Recipient 9', '1976-06-10', 'M', 'O+', 'H001', 'BB001'),
('R010', 'Recipient 10', '1992-08-25', 'F', 'A-', 'H002', 'BB002');

-- Create the EQUIPMENT table
CREATE TABLE EQUIPMENT (
    EQUIP_ID INT PRIMARY KEY,
    PRICE INT,
    DATE_OF_PUR DATE,
    DUE INT,
    BLOOD_BANK_ID VARCHAR(20),
    FOREIGN KEY (BLOOD_BANK_ID) REFERENCES BLOOD_BANK(BLOOD_BANK_ID)
);
SELECT *FROM EQUIPMENT;
-- Insert tuples into EQUIPMENT
INSERT INTO EQUIPMENT (EQUIP_ID, PRICE, DATE_OF_PUR, DUE, BLOOD_BANK_ID) VALUES
(2001, 5000, '2022-01-10', 3, 'BB001'),
(2002, 7000, '2021-11-20', 2, 'BB002'),
(2003, 6000, '2022-02-15', 4, 'BB001'),
(2004, 8000, '2022-03-05', 5, 'BB002'),
(2005, 5500, '2022-04-08', 3, 'BB001'),
(2006, 6500, '2022-05-12', 4, 'BB002'),
(2007, 7500, '2022-06-18', 2, 'BB001'),
(2008, 9000, '2022-07-25', 3, 'BB002'),
(2009, 5800, '2022-08-30', 4, 'BB001'),
(2010, 7200, '2022-09-05', 5, 'BB002');


SELECT * FROM BLOOD_BANK;

SELECT BLOOD_GROUP, MAX(QUANTITY) AS MAX_QUANTITY
FROM BLOOD
GROUP BY BLOOD_GROUP;


SELECT B.BNAME, SUM(S.SALARY) AS TOTAL_SALARY
FROM STAFF S
JOIN BLOOD_BANK B ON S.BLOOD_BANK_ID = B.BLOOD_BANK_ID
GROUP BY B.BNAME;

SELECT B.BLOOD_BANK_ID, B.BNAME, SUM(BD.QUANTITY) AS TOTAL_BLOOD_USED
FROM BLOOD_BANK B
JOIN DONOR D ON B.BLOOD_BANK_ID = D.BLOOD_BANK_ID
JOIN BLOOD BD ON D.DONOR_ID = BD.DONOR_ID
GROUP BY B.BLOOD_BANK_ID, B.BNAME;


    SELECT B.BLOOD_GROUP, SUM(B.QUANTITY) AS TOTAL_AVAILABLE_BLOOD
FROM BLOOD B
GROUP BY B.BLOOD_GROUP;


SELECT S.STAFF_ID, S.SNAME, S.SALARY, S.BLOOD_BANK_ID
FROM STAFF S
JOIN (
    SELECT BLOOD_BANK_ID, MAX(SALARY) AS MAX_SALARY
    FROM STAFF
    GROUP BY BLOOD_BANK_ID
) T ON S.BLOOD_BANK_ID = T.BLOOD_BANK_ID AND S.SALARY = T.MAX_SALARY;

SELECT B.BLOOD_BANK_ID, B.BNAME, SUM(BD.QUANTITY) AS TOTAL_BLOOD_USED
FROM BLOOD_BANK B
JOIN DONOR D ON B.BLOOD_BANK_ID = D.BLOOD_BANK_ID
JOIN BLOOD BD ON D.DONOR_ID = BD.DONOR_ID
GROUP BY B.BLOOD_BANK_ID, B.BNAME;

SELECT BLOOD_GROUP, 
       COUNT(*) AS TOTAL_COUNT, 
       ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM BLOOD), 2) AS PERCENTAGE
FROM BLOOD


GROUP BY BLOOD_GROUP;



SELECT H.HOSP_NAME, SUM(B.QUANTITY) AS TOTAL_BLOOD_USED
FROM HOSPITAL H
JOIN RECIPIENT R ON H.HOSP_ID = R.HOSP_ID
JOIN BLOOD B ON R.DONOR_ID = B.DONOR_ID
GROUP BY H.HOSP_NAME
ORDER BY TOTAL_BLOOD_USED DESC;

SELECT H.HOSP_NAME, SUM(B.QUANTITY) AS TOTAL_BLOOD_USED
FROM HOSPITAL H
JOIN RECIPIENT R ON H.HOSP_ID = R.HOSP_ID
JOIN BLOOD B ON R.DONOR_ID = B.DONOR_ID
GROUP BY H.HOSP_NAME
ORDER BY TOTAL_BLOOD_USED ASC;

SELECT B.BLOOD_BANK_ID, B.BNAME, SUM(E.PRICE) AS TOTAL_REVENUE
FROM BLOOD_BANK B
JOIN EQUIPMENT E ON B.BLOOD_BANK_ID = E.BLOOD_BANK_ID
GROUP BY B.BLOOD_BANK_ID, B.BNAME;